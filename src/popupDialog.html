<!doctype html>
<html>
  <head>
    <title>Team Member Randomizer</title>
    <script src="../node_modules/vss-web-extension-sdk/lib/VSS.SDK.min.js"></script>
    <script src="scripts/utils.js"></script>
    <script type="module">
      import { getAvailableMembers, saveAvailableMembers } from './scripts/dataService.js';
      window.getAvailableMembers = getAvailableMembers;
      window.saveAvailableMembers = saveAvailableMembers;
    </script>
    <script src="scripts/popupDialog.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      body::-webkit-scrollbar {
        width: 12px;
      }

      .container {
        padding: 16px;
      }

      .section {
        margin-bottom: 20px;
      }

      .section-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .section-header label {
        font-weight: 600;
        font-size: 14px;
      }

      .refresh-button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 4px 8px;
        font-size: 16px;
        color: #0078d4;
      }

      .refresh-button:hover {
        background-color: #f3f2f1;
        border-radius: 2px;
      }

      .content-text {
        margin: 0;
        padding: 8px;
        min-height: 20px;
      }

      .team-selector {
        width: 100%;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #8a8886;
        border-radius: 2px;
        color: var(--text-primary);
      }

      #team {
        width: 100%;
        overflow-y: auto;
        max-height: calc(100vh - 400px);
        border-collapse: collapse;
      }

      #team tr {
        border-bottom: 1px solid #e0e0e0;
      }

      #team td {
        padding: 8px;
        vertical-align: middle;
      }

      #team td:first-child {
        width: 30px;
        text-align: center;
        font-weight: 500;
      }

      #team td:nth-child(2) {
        width: 50px;
        padding: 4px;
      }

      #team td:nth-child(2) img {
        display: block;
        border-radius: 50%;
      }

      #team td:nth-child(3) {
        padding-left: 12px;
      }

      .bold {
        font-weight: bold;
        background-color: #f0f0f0;
      }

      .completed {
        text-decoration: line-through;
        color: #999;
        opacity: 0.6;
      }

      #message {
        margin: 10px;
      }

      #canvas {
        display: none;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #605e5c;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <p id="message" style="display: none"></p>
    <div class="container">
      <div class="section">
        <div class="section-header">
          <label>Question of the Day</label>
          <button id="buttonRandomQuestion" class="refresh-button" title="Refresh Question">Random</button>
        </div>
        <p id="question" class="content-text"></p>
      </div>

      <div class="section">
        <div class="section-header">
          <label>Holiday of the Day</label>
          <button id="buttonRandomHotD" class="refresh-button" title="Refresh Holiday">Random</button>
        </div>
        <p id="hotd" class="content-text"></p>
      </div>

      <div class="section">
        <label for="teamSelector">Team</label>
        <select id="teamSelector" class="team-selector">
          <option value="">Select a team...</option>
        </select>
      </div>

      <div id="teamMembersContainer" style="display: none;">
        <table id="team"></table>
      </div>

      <div id="loadingIndicator" class="loading" style="display: none;">Loading team members...</div>
    </div>
    <script type="module">
      'use strict';
      import * as SDK from '../node_modules/azure-devops-extension-sdk/esm/SDK.js';

      SDK.init({ applyTheme: true });

      SDK.ready().then(async () => {
        VSS.require(['VSS/Service', 'TFS/Core/RestClient'], (VSS_Service, TFS_Core_RestClient) => {
          const coreClient = VSS_Service.getCollectionClient(TFS_Core_RestClient.CoreHttpClient);
          const _webContext = SDK.getWebContext();

          loadData(coreClient, _webContext, SDK);
          SDK.notifyLoadSucceeded();
        });
      });
    </script>
  </body>
</html>
